(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[334],{44250:(e,t,s)=>{Promise.resolve().then(s.bind(s,97922))},64225:(e,t,s)=>{"use strict";s.d(t,{M:()=>l});var a=s(1521);function l(e,t){let[s,l]=(0,a.useState)(e);return{viewType:s,setViewType:l,toggleView:()=>{if(t&&t.length>1){let e=(t.indexOf(s)+1)%t.length;l(t[e])}},is:e=>s===e}}},97922:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eE});var a=s(73365),l=s(50627),i=s(1521),r=s(87363),n=s(38862),o=s(80613),d=s(92890),c=s(92222),m=s(31145),x=s(61831);let u=e=>{let{entityName:t="item",query:s,className:l}=e,{t:i}=(0,c.Bd)();return(0,a.jsx)("div",{className:"h-screen w-screen flex items-center justify-center bg-gray-50 ".concat(l),children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-center max-w-md",children:[(0,a.jsx)("div",{className:"mb-6 p-6 bg-white rounded-full shadow-sm border border-gray-100 group-hover:shadow-md transition-shadow duration-200",children:(0,a.jsx)(x.tUi,{size:48,className:"text-gray-400"})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:i("notFound.title",{entityName:t.toLowerCase()})}),s?(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:i("notFound.noResultsFor",{query:s})}):(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:i("notFound.tryAdjusting")})]}),(0,a.jsx)("div",{className:"mt-6 text-xs text-gray-500",children:i("notFound.suggestion")})]})})};var h=s(32427),g=s(90301),p=s(49656),v=s(17545),j=s(31691),b=s(71062),y=s(59296),f=s(17054),N=s(98494),k=s(61637),C=s(69417),A=s(90980),w=s(5484),T=s(35935),O=s(31643);let D=e=>{let{items:t,onQuantityChange:s,onRemoveItem:l,tableProps:i}=e,{t:n}=(0,c.Bd)(),o=[{label:"",align:"center"},{label:n("modules.cart.type"),align:"center"},{label:n("modules.cart.code"),align:"left"},{label:n("modules.cart.name"),align:"left"},{label:n("modules.cart.unitPrice"),align:"right"},{label:n("modules.cart.quantity"),align:"center"},{label:n("modules.cart.totalPrice"),align:"right"}],d=[{render:e=>(0,a.jsx)(O.J,{onClick:()=>null==l?void 0:l(e)})},{render:e=>(0,a.jsx)("div",{className:"flex justify-center text-gray-500",children:"PRODUCT"===e.type?(0,a.jsx)(r.TXh,{}):(0,a.jsx)(r.AcU,{})})},{render:e=>{var t,s,l,i;let r=null!==(i=null!==(l=null===(t=e.product)||void 0===t?void 0:t.productCode)&&void 0!==l?l:null===(s=e.service)||void 0===s?void 0:s.serviceCode)&&void 0!==i?i:"";return(0,a.jsx)("span",{className:"font-mono",children:r})}},{render:e=>{var t,s,l,i;let r=null!==(i=null!==(l=null===(t=e.product)||void 0===t?void 0:t.name)&&void 0!==l?l:null===(s=e.service)||void 0===s?void 0:s.name)&&void 0!==i?i:"";return(0,a.jsx)("span",{className:"font-medium",children:r})},className:"bg-zinc-50"},{render:e=>{var t,s,l,i;let r=null!==(i=null!==(l=null===(t=e.product)||void 0===t?void 0:t.unitPrice)&&void 0!==l?l:null===(s=e.service)||void 0===s?void 0:s.price)&&void 0!==i?i:0;return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 font-medium whitespace-nowrap",children:[(0,a.jsx)(x.H4F,{size:16}),r.toFixed(2)]})}},{render:e=>(0,a.jsx)("input",{type:"number",min:0,max:1e3,value:e.quantity,onChange:t=>null==s?void 0:s(e,Math.min(1e3,Math.max(0,Number(t.target.value)))),className:"w-16 text-left border border-gray-300 rounded-md p-3"})},{render:e=>{var t,s,l,i;let r=(null!==(i=null!==(l=null===(t=e.product)||void 0===t?void 0:t.unitPrice)&&void 0!==l?l:null===(s=e.service)||void 0===s?void 0:s.price)&&void 0!==i?i:0)*e.quantity;return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 font-semibold whitespace-nowrap",children:[(0,a.jsx)(x.H4F,{size:16}),r.toFixed(2)]})}}];return(0,a.jsx)(T.W,{data:t,headerColumns:o,dataColumns:d,padding:{headerCell:{all:4},dataCell:{all:6}},...i})};var S=s(75135),E=s(34688),I=s(51491);function P(e){var t,s;let{ticket:l,ticketItems:i,refetchItems:n}=e,{t:o}=(0,c.Bd)(),m=(0,I.A)(e=>k.Z.getAll({query:{search:e,includeDetails:!0}}),500),u=(0,I.A)(e=>C.X.getAll({query:{search:e}}),500),h=d.XD.useCreate({},{onSuccess:()=>n(),onError:e=>{console.error("Failed to create ticket item:",e.message),n()}}),T=d.XD.useUpdate({},{onSuccess:()=>n(),onError:e=>{console.error("Failed to update ticket item:",e.message),n()}}),O=d.XD.useDelete({},{onSuccess:()=>n(),onError:e=>{console.error("Failed to delete ticket item:",e.message),n()}}),P=(e,t)=>{"PRODUCT"===t?m.setQuery(""):u.setQuery("");let s=i.find(s=>s.type===t&&("PRODUCT"===t?s.productId===e.id:s.serviceId===e.id));if(s){T.mutate({id:s.id,dto:{quantity:s.quantity+1}});return}let a={ticketId:l.id,type:t,quantity:1};"PRODUCT"===t?h.mutate({...a,productId:e.id}):h.mutate({...a,serviceId:e.id})};return(0,a.jsxs)("div",{className:"p-6 flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-10",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("label",{className:"font-semibold mb-1 flex items-center gap-2",children:[o("entities.product.searchProducts"),(0,a.jsx)(g.A,{title:(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsx)("div",{className:"border-b border-gray-100 pb-2",children:(0,a.jsx)("div",{className:"font-medium text-gray-800",children:o("common.ui.searchCriteria")})}),(0,a.jsx)("div",{className:"space-y-2",children:o("entities.product.searchKeys",{returnObjects:!0}).map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"•"}),(0,a.jsx)("span",{className:"font-medium text-gray-700",children:e})]},e))})]}),arrow:!0,componentsProps:{tooltip:{sx:{bgcolor:"white",color:"black",border:"1px solid #E5E7EB",boxShadow:"0px 4px 12px rgba(0,0,0,0.1)",borderRadius:2,p:2}}},children:(0,a.jsx)(N.A,{className:"text-gray-400 hover:text-gray-600 cursor-pointer transition-colors",fontSize:"small"})})]}),(0,a.jsx)("div",{className:"border rounded-md border-gray-300",children:(0,a.jsx)(p.A,{fullWidth:!0,placeholder:o("common.placeholders.search"),value:m.query,onChange:e=>{m.setQuery(e.target.value),u.setResults(void 0)},InputProps:{startAdornment:(0,a.jsx)(v.A,{position:"start",children:(0,a.jsx)(j.A,{"aria-label":o("common.actions.search"),onClick:()=>m.searchNow(m.query),edge:"start",size:"small",children:(0,a.jsx)(f.A,{})})}),endAdornment:m.loading?(0,a.jsx)(v.A,{position:"end",children:(0,a.jsx)(b.A,{size:20})}):null},sx:{"& .MuiInputBase-root":{border:"none"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}})})]}),(0,a.jsx)(y.A,{flexItem:!0,orientation:"vertical",className:"hidden md:block"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("label",{className:"font-semibold mb-1 flex items-center gap-2",children:[o("entities.service.searchServices"),(0,a.jsx)(g.A,{title:(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsx)("div",{className:"border-b border-gray-100 pb-2",children:(0,a.jsx)("div",{className:"font-medium text-gray-800",children:o("common.ui.searchCriteria")})}),(0,a.jsx)("div",{className:"space-y-2",children:o("entities.service.searchKeys",{returnObjects:!0}).map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"•"}),(0,a.jsx)("span",{className:"font-medium text-gray-700",children:e})]},e))})]}),arrow:!0,componentsProps:{tooltip:{sx:{bgcolor:"white",color:"black",border:"1px solid #E5E7EB",boxShadow:"0px 4px 12px rgba(0,0,0,0.1)",borderRadius:2,p:2}}},children:(0,a.jsx)(N.A,{className:"text-gray-400 hover:text-gray-600 cursor-pointer transition-colors",fontSize:"small"})})]}),(0,a.jsx)("div",{className:"border rounded-md border-gray-300",children:(0,a.jsx)(p.A,{fullWidth:!0,placeholder:o("common.placeholders.search"),value:u.query,onChange:e=>{u.setQuery(e.target.value),m.setResults(void 0)},InputProps:{startAdornment:(0,a.jsx)(v.A,{position:"start",children:(0,a.jsx)(j.A,{"aria-label":o("common.actions.search"),onClick:()=>u.searchNow(u.query),edge:"start",size:"small",children:(0,a.jsx)(f.A,{})})}),endAdornment:u.loading?(0,a.jsx)(v.A,{position:"end",children:(0,a.jsx)(b.A,{size:20})}):null},sx:{"& .MuiInputBase-root":{border:"none"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}})})]})]}),(m.results&&(null===(t=m.results)||void 0===t?void 0:t.length)>0||u.results&&(null===(s=u.results)||void 0===s?void 0:s.length)>0)&&(0,a.jsx)("div",{className:"text-center text-xs text-gray-500",children:o("modules.cart.clickToAdd")}),m.results&&(0,a.jsx)(S.t,{defaultTab:"products",tabs:[{key:"products",label:o("entities.product.plural"),icon:(0,a.jsx)(r.TXh,{}),count:m.results.length,content:(0,a.jsx)("div",{className:"max-h-[600px]",children:m.results.length>0?(0,a.jsx)(w.Z,{products:m.results,tableProps:{padding:{headerCell:{x:2,y:0},dataCell:{all:2}},classNames:{dataCell:"text-sm"},ignoreColumns:[0,7,8,11],pagination:{enabled:!0,initialPageSize:5},search:{enabled:!1},onRowClick:e=>{P(e,"PRODUCT")}}}):(0,a.jsx)(E.p,{message:o("states.notFound.title",{entity:o("entities.product.plural").toLowerCase()})})})}]}),u.results&&(0,a.jsx)(S.t,{defaultTab:"services",tabs:[{key:"services",label:o("entities.service.plural"),icon:(0,a.jsx)(r.jNV,{}),count:u.results.length,content:(0,a.jsx)("div",{className:"max-h-[600px]",children:u.results.length>0?(0,a.jsx)(A.v,{services:u.results,tableProps:{padding:{headerCell:{x:2,y:0},dataCell:{x:4,y:2}},classNames:{dataCell:"text-sm"},ignoreColumns:[0,5],pagination:{enabled:!0,initialPageSize:5},search:{enabled:!1},onRowClick:e=>{P(e,"SERVICE")}}}):(0,a.jsx)(E.p,{message:o("states.notFound.title",{entity:o("entities.service.plural").toLowerCase()})})})}]}),i.length?(0,a.jsx)(D,{items:i,onQuantityChange:(e,t)=>{0===t?O.mutate(e.id):T.mutate({id:e.id,dto:{quantity:t}})},onRemoveItem:e=>{O.mutate(e.id)},tableProps:{padding:{headerCell:{all:2},dataCell:{all:3}},classNames:{dataCell:"text-sm"},pagination:{enabled:!1},search:{enabled:!1}}}):(0,a.jsx)(E.p,{message:o("modules.cart.emptyMessage"),className:"rounded-md text-sm"}),i.length>0&&(0,a.jsx)("div",{className:"relative rounded-2xl px-4 w-full flex flex-col md:flex-row justify-end items-end md:items-center",children:(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[(0,a.jsxs)("div",{className:"mr-2 text-xl font-bold flex items-center gap-1 text-gray-800",children:[(0,a.jsx)(x.H4F,{size:24,className:"text-emerald-600"}),l.finalCost.toFixed(2)]}),(0,a.jsx)("div",{className:"mt-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:o("modules.cart.totalAmount")})]}),(null==l?void 0:l.estimatedCost)&&(0,a.jsxs)("div",{className:"mt-4 text-right",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"font-medium",children:[o("modules.cart.estimatedProfit"),":"]})," ",(0,a.jsx)("span",{className:l.estimatedCost-l.finalCost>=0?"text-green-600":"text-red-600",children:(l.estimatedCost-l.finalCost).toFixed(2)})]}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:o("modules.cart.basedOnEstimatedPrice")})]})]})})]})}var L=s(72338),G=s(36115),z=s(53867),F=s(44311),_=s(46313),R=s(17349),M=s(35227);let B=(e,t,s,a)=>{let l={...(0,R.getDefaultTaskForm)(),ticketId:e},i=(0,M.A)({itemName:"Task",initialValues:t,defaultValues:l,itemId:null==t?void 0:t.id,onClose:s,onSuccess:a,createRecord:d.bI.create,updateRecord:d.bI.update,getCreateDto:R.convertTaskFormToDto,getUpdateDto:R.convertTaskFormToDto,validator:R.validateTaskForm});return{form:i,handlers:{updateField:(e,t)=>i.setValues(e,t),handleSelectEmployee:e=>{i.setValues("assignee",e)},handleRemoveEmployee:()=>{i.setValues("assignee",null)},updateTaskField:(e,t)=>{i.setValues(e,t)}}}};var q=s(28402);let U=e=>{var t,s,l,n,o,m;let{open:x,ticketId:u,task:h,variant:g,onSuccess:N,onClose:k}=e,{t:C}=(0,c.Bd)(),{form:A,handlers:w}=B(u,h,k,N),[T,O]=(0,i.useState)(!0),D=(0,I.A)(e=>d.yD.getAll({query:e?{search:e,includeDetails:!0}:{includeDetails:!0}}),1e3),S=(0,i.useCallback)(()=>{D.setQuery(""),O(!0),A.reset()},[A,D]),E=!!h,P=(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-5 space-y-6 text-graphite font-light",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"font-semibold mb-1 block",children:[C("entities.task.title")," ",(0,a.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,a.jsx)(p.A,{fullWidth:!0,required:!0,value:A.values.title,onChange:e=>w.updateTaskField("title",e.target.value),placeholder:C("entities.task.placeholders.title"),error:!!(null===(t=A.validationErrors)||void 0===t?void 0:t.title),helperText:null===(s=A.validationErrors)||void 0===s?void 0:s.title})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold mb-1 block",children:C("common.fields.description")}),(0,a.jsx)("textarea",{rows:4,value:A.values.description,onChange:e=>w.updateTaskField("description",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:C("common.placeholders.description")}),(null===(l=A.validationErrors)||void 0===l?void 0:l.description)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:A.validationErrors.description})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"font-semibold mb-1 block",children:C("entities.task.assignResponsible")}),(0,a.jsxs)("div",{className:"border rounded-md border-gray-300",children:[(0,a.jsx)(p.A,{fullWidth:!0,placeholder:C("entities.task.placeholders.searchEmployee"),value:D.query,onChange:e=>D.setQuery(e.target.value),InputProps:{startAdornment:(0,a.jsx)(v.A,{position:"start",children:(0,a.jsx)(j.A,{"aria-label":C("common.actions.search"),onClick:()=>{D.searchNow(D.query),O(!0)},edge:"start",size:"small",children:(0,a.jsx)(f.A,{})})}),endAdornment:D.loading?(0,a.jsx)(v.A,{position:"end",children:(0,a.jsx)(b.A,{size:20})}):null},sx:{"& .MuiInputBase-root":{border:"none"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}}),A.values.assignee&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.A,{}),(0,a.jsx)(L.D,{employee:A.values.assignee,size:"xs",onRemove:w.handleRemoveEmployee})]})]}),(0,a.jsx)(z.l,{onSelectEmployee:e=>{w.handleSelectEmployee(e),D.setQuery(""),O(!1)},employees:D.results,resultsVisible:T,setResultsVisibility:O}),(null===(n=A.validationErrors)||void 0===n?void 0:n.assignee)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:A.validationErrors.assignee})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsx)("label",{className:"font-semibold",children:C("entities.task.dueDate")}),A.values.dueDate&&(0,a.jsx)(j.A,{size:"small",color:"error",onClick:()=>w.updateField("dueDate",(0,q.Oc)()),className:"bg-red-200",children:(0,a.jsx)(_.FO3,{size:18})})]}),(0,a.jsx)(p.A,{fullWidth:!0,type:"date",value:A.values.dueDate?(0,q.Oc)(A.values.dueDate):"",onChange:e=>w.updateTaskField("dueDate",e.target.value),error:!!(null===(o=A.validationErrors)||void 0===o?void 0:o.dueDate),helperText:null===(m=A.validationErrors)||void 0===m?void 0:m.dueDate})]})]})}),R=r.w8j,M=E?r.uO9:r.OiG;return(0,a.jsx)(G.I,{open:x,canSubmit:A.canSubmit,variant:g,title:C(E?"entities.task.edit":"entities.task.create"),titleIcon:(0,a.jsx)(R,{size:22}),primaryActionLabel:C(E?"forms.saveChanges":"entities.task.create"),primaryActionIcon:(0,a.jsx)(M,{}),onSubmit:A.submit,onClose:k,onReset:S,hasUnsavedChanges:A.isDirty,secondaryAction:"inline"===g?(0,a.jsx)(F.r,{label:C("common.actions.cancel"),color:"red",icon:null,onClick:k}):void 0,children:P})};var V=s(1611),H=s(375),Q=s(68663),X=s(95206),K=s(40229),W=s(3677),Z=s(29875),J=s(62344),Y=s(67826),$=s(46031),ee=s(65587),et=s(13286);let es={TODO:{icon:V.A,label:"entities.task.status.todo",color:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"},COMPLETED:{icon:et.A,label:"entities.task.status.completed",color:"text-green-600",bg:"bg-green-50",border:"border-green-200"}},ea=e=>{let{status:t,onClick:s}=e,{t:l}=(0,c.Bd)(),i=es[t],r=i.icon;return(0,a.jsxs)("button",{onClick:s,className:"\n        px-2 py-1 text-xs rounded-md border flex items-center gap-1 transition-colors hover:opacity-80\n        ".concat(i.bg," ").concat(i.border," ").concat(i.color,"\n      "),children:[(0,a.jsx)(r,{fontSize:"inherit"}),l(i.label)]})},el=e=>{if(!e)return"text-gray-400";let t=new Date;if((0,J.d)(t,e))return"text-red-600";let s=(0,Y.m)(e,t);return s<=1?"text-red-500":s<=3?"text-orange-500":"text-gray-500"},ei=e=>{var t;let{task:s,onEditTask:l,onDeleteTask:r,onStatusChange:n}=e,{t:o}=(0,c.Bd)(),[d,m]=(0,i.useState)(!1),x=es[s.status],u=(null==x?void 0:x.icon)||V.A,h=s.dueDate&&(0,J.d)(new Date,s.dueDate);return(0,a.jsxs)("div",{className:"bg-white rounded-lg border ".concat((null==x?void 0:x.border)||"border-gray-200","\n                  hover:shadow-sm transition-all duration-200"),children:[(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-md ".concat(null==x?void 0:x.bg," ").concat(null==x?void 0:x.border," border"),children:(0,a.jsx)(u,{className:"w-4 h-4 ".concat(null==x?void 0:x.color)})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium ".concat("COMPLETED"===s.status?"line-through text-gray-500":"text-gray-900"),children:s.title}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[s.description&&(0,a.jsx)("button",{onClick:()=>m(e=>!e),className:"p-1 text-gray-400 hover:text-gray-600 rounded transition-colors animate-blink",title:o("entities.task.viewDescription"),children:d?(0,a.jsx)(H.A,{className:"w-4 h-4"}):(0,a.jsx)(Q.A,{className:"w-4 h-4"})}),"COMPLETED"!==s.status&&(0,a.jsx)("button",{onClick:()=>null==l?void 0:l(s),className:"p-1 text-gray-400 hover:text-blue-600 rounded transition-colors",title:o("entities.task.editTask"),children:(0,a.jsx)(X.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>null==r?void 0:r(s),className:"p-1 text-gray-400 hover:text-red-600 rounded transition-colors",title:o("entities.task.deleteTask"),children:(0,a.jsx)(K.A,{className:"w-4 h-4"})})]})]})})]}),(0,a.jsxs)("div",{className:"pt-4 flex flex-col space-y-4 border-t border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(null==x?void 0:x.bg," ").concat(null==x?void 0:x.color," border ").concat(null==x?void 0:x.border),children:o("entities.task.status.".concat(s.status.toLowerCase()))}),s.dueDate&&(0,a.jsxs)("div",{className:"flex items-center gap-1 ".concat(el(s.dueDate)),children:[(0,a.jsx)(W.A,{sx:{fontSize:"1rem"}}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,$.GP)(s.dueDate,"dd/MM/yyyy HH:mm",{locale:ee.ro}),h&&(0,a.jsxs)("span",{className:h?"font-medium":"",children:["(",o("common.ui.overdue"),")"]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(Z.A,{sx:{fontSize:"1rem"}}),s.assignee?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-gray-900 font-medium",children:s.assignee.fullName}),s.assignee.department&&(0,a.jsx)("span",{className:"ml-1 inline-block rounded-full bg-gray-100 px-2 py-0.5 text-gray-600 border border-gray-400",children:(0,q.wR)(s.assignee.department.name)})]}):(0,a.jsx)("span",{className:"text-gray-500",children:o("common.ui.unassigned")})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("span",{children:[o("entities.task.createdAt"),":"," ",(0,$.GP)(s.createdAt,"dd/MM")]}),s.completedAt&&(0,a.jsxs)("span",{children:[o("entities.task.completedAt"),":"," ",(0,$.GP)(s.completedAt,"dd/MM")]})]})]}),(null===(t=s.taskComments)||void 0===t?void 0:t.length)>0&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[s.taskComments.length," ",o("entities.task.comments")]})]}),"COMPLETED"!==s.status&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500 mr-2",children:[o("entities.task.changeStatus"),":"]}),Object.keys(R.TaskStatus).filter(e=>e!==s.status).map(e=>(0,a.jsx)(ea,{status:e,onClick:()=>null==n?void 0:n(s,e)},e))]})]}),d&&s.description&&(0,a.jsxs)("div",{className:"flex items-center p-4 border-t border-gray-100",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500 mr-4",children:[o("common.fields.description"),":"]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 whitespace-pre-wrap",children:s.description})]})]})};var er=s(12519),en=s(73773);let eo=e=>{let{tasks:t,onEditTask:s,refetchTasks:l}=e,{t:r}=(0,c.Bd)(),{selectedTask:n,newStatus:o,isStatusDialogOpen:m,isDeleteDialogOpen:x,updateStatusMutation:u,deleteTaskMutation:h,openStatusDialog:g,openDeleteDialog:p,confirmStatusChange:v,confirmDelete:j,closeDialogs:b}=function(e){let[t,s]=(0,i.useState)(null),[a,l]=(0,i.useState)(null),[r,n]=(0,i.useState)(null),o=()=>{s(null),l(null),n(null)},c=()=>{o(),null==e||e()},m=(0,en.n)({mutationFn:e=>{let{taskId:t,status:s}=e;return d.bI.updateStatus(t,{status:s})},onSuccess:c,onError:e=>{console.error("Failed to update task status:",e.message)}}),x=(0,en.n)({mutationFn:async e=>{await d.bI.delete(e)},onSuccess:c,onError:e=>{console.error("Failed to delete task:",e.message)}});return{selectedTask:t,newStatus:a,isStatusDialogOpen:"status"===r,isDeleteDialogOpen:"delete"===r,updateStatusMutation:m,deleteTaskMutation:x,openStatusDialog:(e,t)=>{s(e),l(t),n("status")},openDeleteDialog:e=>{s(e),n("delete")},confirmStatusChange:()=>{t&&a&&m.mutate({taskId:t.id,status:a})},confirmDelete:()=>{t&&x.mutate(t.id)},closeDialogs:o}}(l);return 0===t.length?(0,a.jsx)("div",{className:"text-sm text-center p-8 text-gray-500",children:r("entities.task.noTasks")}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"px-4 pb-4 space-y-3",children:t.map(e=>(0,a.jsx)(ei,{task:e,onEditTask:s,onDeleteTask:p,onStatusChange:g},e.id))}),(0,a.jsx)(er.T,{open:m,title:r("entities.task.statusChange"),content:(0,a.jsxs)("div",{className:"flex flex-col items-center text-center space-y-4",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[r("entities.task.confirmStatusChange")," ",(0,a.jsxs)("span",{className:"font-medium",children:['"',null==n?void 0:n.title,'"']}),"?"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[n&&(0,a.jsx)(ea,{status:n.status}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"→"}),o&&(0,a.jsx)(ea,{status:o})]})]}),confirmText:r(u.isPending?"common.status.processing":"common.actions.confirm"),cancelText:r("common.actions.cancel"),onConfirm:v,onCancel:b}),(0,a.jsx)(er.T,{open:x,title:r("entities.task.deleteTaskConfirm"),content:(0,a.jsxs)("p",{className:"text-sm text-gray-700 text-center",children:[r("entities.task.confirmDelete")," ",(0,a.jsxs)("span",{className:"font-medium",children:['"',null==n?void 0:n.title,'"']}),"?"]}),confirmText:r(h.isPending?"common.status.processing":"common.actions.delete"),cancelText:r("common.actions.cancel"),onConfirm:j,onCancel:b})]})};var ed=s(80188),ec=s(89467);let em={[R.LOG_ACTION.CREATE]:r.tVd,[R.LOG_ACTION.UPDATE]:r.uO9,[R.LOG_ACTION.DELETE]:r.qbC,[R.LOG_ACTION.UPDATE_STATE]:r.yk7,[R.LOG_ACTION.ASSIGN]:r.NPy,[R.LOG_ACTION.UNASSIGN]:r.Dby,[R.LOG_ACTION.ADD]:r.OiG,[R.LOG_ACTION.EDIT]:r.uO9,[R.LOG_ACTION.CHANGE_STATUS]:r.yk7,[R.LOG_ACTION.MARK_DONE]:r.CMH},ex={[R.LOG_ACTION.CREATE]:"green",[R.LOG_ACTION.UPDATE]:"blue",[R.LOG_ACTION.DELETE]:"red",[R.LOG_ACTION.UPDATE_STATE]:"purple",[R.LOG_ACTION.ASSIGN]:"teal",[R.LOG_ACTION.UNASSIGN]:"orange",[R.LOG_ACTION.ADD]:"emerald",[R.LOG_ACTION.EDIT]:"blue",[R.LOG_ACTION.CHANGE_STATUS]:"purple",[R.LOG_ACTION.MARK_DONE]:"green"},eu=e=>{let{action:t,size:s=16}=e,l=s+16,i=t?em[t]:ec.Ohp,r=t?ex[t]:"gray",n="bg-".concat(r,"-50"),o="border-".concat(r,"-200"),d="text-".concat(r,"-600");return(0,a.jsx)("div",{className:"flex items-center justify-center rounded-md border ".concat(n," ").concat(o),style:{width:l,height:l},children:(0,a.jsx)(i,{size:s,className:d})})},eh=e=>{let{activities:t,isLoading:s,error:l,onViewEntity:n}=e,{t:o}=(0,c.Bd)(),[d,x]=(0,i.useState)(new Set),u=e=>{x(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})};return s?(0,a.jsx)(m.k,{message:o("modules.activity.loading")}):l?(0,a.jsxs)("div",{className:"p-4 text-sm text-center py-8 text-red-600",children:[(0,a.jsx)(ed.A,{className:"mb-2 mx-auto"}),(0,a.jsx)("p",{children:o("modules.activity.error")})]}):(0,a.jsx)("div",{children:(null==t?void 0:t.length)===0?(0,a.jsx)("div",{className:"text-sm text-center p-8 text-gray-500",children:(0,a.jsx)("p",{children:o("modules.activity.noActivities")})}):(0,a.jsxs)("div",{className:"relative p-3",children:[(0,a.jsx)("div",{className:"absolute left-10 top-10 bottom-10 w-0.5 bg-gray-200"}),(0,a.jsx)("div",{className:"space-y-6",children:null==t?void 0:t.map(e=>{let t=e.details&&Object.keys(e.details).length>0,s=d.has(e.id),l=e.entity&&e.entityId,i=o("log.actions.".concat((0,q.Cb)(e.action))),c=o("common.entities.".concat((0,q.Cb)(e.entity))),{translationKey:m,params:x}=(0,R.getLogMessageKeys)(i,""),h=o(m,x);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute left-7 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 shadow-lg rounded-md",children:eu({action:e.action})}),(0,a.jsxs)("div",{className:"ml-16 bg-white rounded-lg p-4 border border-gray-100 hover:shadow-sm transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("p",{className:"text-sm font-light text-gray-900",children:[String(h)," ",(0,a.jsx)("span",{className:"font-semibold",children:c})]}),(0,a.jsx)("time",{className:"text-xs text-gray-500 bg-gray-50 px-2 py-1 rounded-full",children:(0,$.GP)(new Date(e.createdAt),"HH:mm")})]}),e.author&&(0,a.jsxs)("p",{className:"text-xs text-gray-600 flex items-center gap-1 mb-2",children:[(0,a.jsx)(Z.A,{className:"w-3 h-3"}),e.author.fullName]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(0,$.GP)(new Date(e.createdAt),"dd/MM/yyyy HH:mm")})]}),t&&(0,a.jsx)("button",{onClick:()=>u(e.id),className:"ml-2 p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded transition-colors",title:o("modules.activity.viewDetails"),children:s?(0,a.jsx)(H.A,{}):(0,a.jsx)(Q.A,{})})]}),t&&s&&(0,a.jsxs)("div",{className:"mt-4",children:[l&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded-md border border-gray-200",children:[o("common.fields.id"),": #",e.entityId]}),(0,a.jsx)(g.A,{title:"".concat(o("common.actions.view")," ").concat(c),children:(0,a.jsx)(j.A,{size:"small",onClick:()=>null==n?void 0:n(e.entity,e.entityId),className:"hover-text-black",children:(0,a.jsx)(r.Ny1,{})})})]}),(0,a.jsxs)("h4",{className:"text-xs font-medium text-gray-700 mb-2",children:[o("common.fields.details"),":"]}),(0,a.jsx)("pre",{className:"text-xs font-mono bg-gray-50 text-gray-800 p-3 border border-gray-200 rounded-md overflow-x-auto",children:JSON.stringify(e.details,null,2)})]})]})]},e.id)})})]})})};var eg=s(12615),ep=s(1824),ev=s(56693),ej=s(959);let eb=e=>{let{onCreateTask:t,onCreateComment:s,menuAnchorEl:l,onMenuOpen:i,onMenuClose:r}=e,{t:n}=(0,c.Bd)();return(0,a.jsxs)("div",{className:"flex items-center justify-center py-4 bg-white/80 border-t border-gray-300 drop-shadow-md",style:{boxShadow:"0 -6px 12px -3px rgba(0,0,0,0.07), 0 6px 12px -3px rgba(0,0,0,0.07)"},children:[(0,a.jsxs)("button",{onClick:t,className:"flex items-center gap-1.5 bg-white border border-gray-300 text-gray-900 text-sm font-medium px-4 py-2 hover:border-gray-900 transition-colors",children:[(0,a.jsx)(ev.A,{sx:{fontSize:"0.85rem"}}),n("entities.task.create")]}),(0,a.jsxs)("button",{onClick:s,className:"flex items-center gap-1.5 bg-white border border-gray-300 text-gray-900 text-sm font-medium px-4 py-2 hover:border-gray-900 transition-colors",children:[(0,a.jsx)(ev.A,{sx:{fontSize:"0.85rem"}}),n("entities.ticket.activity.createComment")]}),(0,a.jsxs)("button",{onClick:i,className:"flex items-center gap-1.5 bg-white border border-gray-300 text-gray-900 text-sm font-medium px-4 py-2 hover:border-gray-900 transition-colors",children:[(0,a.jsx)(ej.A,{sx:{fontSize:"0.85rem"}}),n("common.fields.more")]}),(0,a.jsxs)(eg.A,{anchorEl:l,open:!!l,onClose:r,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},children:[(0,a.jsx)(ep.A,{onClick:r,children:n("entities.ticket.activity.attachFile")}),(0,a.jsx)(ep.A,{onClick:r,children:n("common.actions.assign")}),(0,a.jsx)(ep.A,{onClick:r,children:n("entities.ticket.activity.setPriority")}),(0,a.jsx)(ep.A,{onClick:r,children:n("entities.ticket.activity.addChecklist")})]})]})};var ey=s(64225);let ef=e=>{let{isSmallScreen:t,ticketId:s,activityLogs:l=[],tasks:r,comments:n=[],refetch:o}=e,{t:d}=(0,c.Bd)(),{viewType:m,setViewType:x,is:u}=(0,ey.M)(localStorage.getItem("activeSection")||"history",["history","tasks"]),[h,g]=(0,i.useState)({mode:"none"}),[p,v]=(0,i.useState)(null);return(0,i.useEffect)(()=>{localStorage.setItem("activeSection",m)},[m]),(0,a.jsxs)("div",{className:"flex flex-col bg-gray-50 h-full",children:[(0,a.jsxs)("div",{className:"p-3 flex justify-center font-light text-sm space-x-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>x("history"),style:{boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},className:"p-2 rounded-md transition-colors ".concat("history"===m?"bg-white border border-neutral-700":"bg-gray-100"),children:d("modules.activity.history")}),(0,a.jsx)("button",{type:"button",onClick:()=>x("tasks"),style:{boxShadow:"inset 0 2px 4px rgba(0,0,0,0.1)"},className:"p-2 rounded-md transition-colors ".concat("tasks"===m?"bg-white border border-neutral-700":"bg-gray-100"),children:d("entities.task.plural")})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:"history"===m?(0,a.jsx)(eh,{activities:l,isLoading:!1,error:null}):"none"===h.mode?(0,a.jsx)(eo,{tasks:r,refetchTasks:o,onEditTask:e=>{g({mode:"editing",task:e})}}):(0,a.jsx)(U,{open:!0,variant:t?"modal":"inline",ticketId:s,task:"editing"===h.mode?h.task:void 0,onClose:()=>{g({mode:"none"})},onSuccess:o})}),"none"===h.mode&&(0,a.jsx)(eb,{onCreateTask:()=>{x("tasks"),g({mode:"creating"})},onCreateComment:()=>console.log("Add comment"),menuAnchorEl:p,onMenuOpen:e=>{v(e.currentTarget)},onMenuClose:()=>{v(null)}})]})};var eN=s(61905),ek=s(57972),eC=s(40545),eA=s(8646),ew=s(66921),eT=s(23652),eO=s(12525),eD=s(68753);function eS(e){let{ticket:t,onTicketChange:s}=e,{t:l}=(0,c.Bd)(),{id:i,status:r,priority:n,estimatedDeliveryDate:o}=t;return(0,a.jsxs)("div",{className:"p-6 flex flex-col md:flex-row gap-8 items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-center rounded-xl shadow-lg border border-black/20",style:{backgroundColor:eO.Ez[r],width:50,height:50},children:(0,a.jsx)(eN.mwh,{size:30,color:"white",className:"rotate-6"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-3xl text-charcoalBlack/90 font-semibold",children:l("common.entities.ticket")}),(0,a.jsxs)("div",{className:"px-3 bg-gray-50 border border-gray-200 rounded-2xl font-mono shadow-md",children:["#",i]})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-start gap-8",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-700",children:l("common.fields.status")}),(0,a.jsx)(ek.V,{currentState:r,ticketId:t.id,onStateChange:()=>null==s?void 0:s()})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-700",children:l("entities.ticket.priority")}),"URGENT"===n?(0,a.jsx)(eA.GIx,{size:24,className:"text-red-600"}):(0,a.jsx)(eC.A,{label:l("entities.ticket.priorityLevels.".concat(n.toLowerCase())),size:"medium",variant:"outlined",className:"capitalize font-semibold text-xs border-gray-300 text-gray-800"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 text-gray-600",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 items-end text-right",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1 text-xs font-semibold text-gray-700",children:[(0,a.jsx)(ew.n0G,{size:16}),(0,a.jsx)("span",{children:l("entities.ticket.submittedAt")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-charcoalBlack text-sm font-semibold",children:new Date(t.submittedAt).toLocaleDateString("ro-RO")}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:(0,eT.m)(new Date(t.submittedAt),{addSuffix:!0,locale:ee.ro})})]})]}),o&&(0,a.jsxs)("div",{className:"flex flex-col gap-2 items-end text-right",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1 text-xs font-semibold text-gray-700",children:[(0,a.jsx)(ew.QLc,{size:16}),(0,a.jsx)("span",{children:l("entities.ticket.estimatedDeliveryDate")})]}),(0,a.jsxs)("div",{className:"px-1.5 py-0.5 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 justify-end",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-".concat((0,eD.C)(t,500))}),(0,a.jsx)("span",{className:"text-charcoalBlack text-sm font-semibold",children:new Date(o).toLocaleDateString("ro-RO")})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:(0,eT.m)(new Date(o),{addSuffix:!0,locale:ee.ro})})]})]})]})]})]})}function eE(){let{t:e}=(0,c.Bd)(),{id:t}=(0,l.useParams)(),s=Array.isArray(t)?t[0]:t,i=s&&!isNaN(Number(s))?Number(s):null;if(!i)return null;let{data:x,isLoading:g,refetch:p}=d.qB.useGetById(i,{query:{includeDetails:!0,sort:"desc"}}),{data:v,refetch:j}=d.XD.useGetByTicket(i,{includeDetails:!0,sort:"desc"},{queryKey:["ticket-items","ticket",i]}),{data:b,refetch:y}=d.lY.useGetByTicket(i,{includeDetails:!0,sort:"desc"}),{data:f,refetch:N}=d.bI.useGetByTicket(i,{includeDetails:!0,sort:"desc"}),k=(0,o.A)("(max-width: 1000px)");if(g)return(0,a.jsx)(m.k,{message:e("common.status.loading")});if(!x)return(0,a.jsx)(u,{entityName:e("entities.ticket.singular"),query:s});let C=[{key:"general",label:e("modules.tickets.tabs.general"),icon:(0,a.jsx)(r.__w,{}),content:(0,a.jsx)(h.Z,{open:!0,ticket:x,variant:"inline",onSuccess:()=>{p(),y()}})},{key:"items",label:e("modules.tickets.tabs.items"),icon:(0,a.jsx)(r.Kni,{}),content:(0,a.jsx)(P,{ticket:x,ticketItems:null!=v?v:[],refetchItems:()=>{p(),j(),y()}})},{key:"payments",label:e("modules.tickets.tabs.payments"),icon:(0,a.jsx)(r.XVP,{}),content:(0,a.jsx)("div",{className:"h-[calc(100vh-166px)] overflow-y-auto",children:(0,a.jsx)("div",{className:"text-sm text-gray-500 p-4",children:e("modules.tickets.payments.empty")})})}],A={key:"activity",label:e("modules.activity.history"),icon:(0,a.jsx)(n.oPs,{}),content:(0,a.jsx)(ef,{isSmallScreen:!0,ticketId:x.id,tasks:null!=f?f:[],comments:[],activityLogs:null!=b?b:[],refetch:()=>{N(),y()}})},w=()=>{p(),j(),y(),N()};return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsx)(eS,{ticket:x,onTicketChange:w}),(0,a.jsxs)("div",{className:"flex-1 flex flex-row overflow-hidden",children:[(0,a.jsx)("div",{className:"flex-1 min-w-0 overflow-y-auto",children:(0,a.jsx)(S.t,{defaultTab:"general",tabs:k?[...C,A]:C})}),!k&&(0,a.jsx)("div",{className:"w-[30vw] max-w-[50vw] border-l border-gray-100",children:(0,a.jsx)(ef,{isSmallScreen:!1,ticketId:x.id,tasks:null!=f?f:[],comments:[],activityLogs:null!=b?b:[],refetch:w})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[422,915,596,371,616,149,140,829,79,871,672,278,222,671,367,791,765,440,207,420,484,980,347,870,358],()=>t(44250)),_N_E=e.O()}]);